<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Contate-nos | BeatUP ®</title>
    <link rel="icon" type="image/x-icon" href="/imagens/logos/icon.ico">
    <link rel="stylesheet" href="/fonts/stylesheet.css">
    <link rel="stylesheet" href="/css/styles.css">
    <link rel="stylesheet" href="/css/contact.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css">
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.mask/1.14.16/jquery.mask.min.js"></script>
</head>

<body>
    <div class="nav-bar d-flex align-items-center justify-content-between px-4">
        <!-- Logos -->
        <div class="nav-logo">
            <img src="/imagens/logos/logosswht.png" alt="Logo" width="100%" height="100%">
        </div>
        <div class="logo-mobile">
            <img src="/imagens/logos/logosimpwth.png" alt="LogoM" width="100%" height="100%">
        </div>

        <!-- Botão Home e Barra de Pesquisa -->
        <div class="d-flex align-items-center flex-grow-1 justify-content-center">
            <div class="home-button me-3">
                <button class="btn btn-dark d-flex align-items-center justify-content-center">
                    <i class="bi bi-house-door text-white fs-4"></i>
                </button>
            </div>
            <div class="search-bar rounded-pill px-3 d-flex">
                <button><i class="bi bi-search text-white fs-2"></i></button>
                <input type="text" class="bg-transparent text-white text-center" placeholder="O que você quer ouvir?">
            </div>
        </div>

        <!-- Botões Nav-->
        <div class="d-flex align-items-center">

            <!--Barra de Pesquisa e Menu Hamburguer Dispositivos Móveis-->
            <div class="nav-container">
                <div class="welcome-message d-none" id="welcome-message">
                    <span class="text-white text-nowrap"></span>
                    <div class="logout-btn">
                        <button class="logout btn rounded-pill text-white text-center"
                            id="logout-button">Logout</button>
                    </div>
                </div>
                <div class="search-button d-flex align-items-center">
                    <button><i class="bi bi-search text-white fs-2"></i></button>
                </div>
                <div class="menu-hamburguer">
                    <input type="checkbox" name="checkbox" id="hamb-button" class="hamb-button">
                    <label for="hamb-button" class="hamb-icon">
                        <span class="bar"></span>
                    </label>

                    <div class="menuL">
                        <ul>
                            <li><a href="signin.html">Entre</a></li>
                            <li><a href="signup.html">Inscreva-se</a></li>
                            <li><a href="#">Sobre Nós</a></li>
                            <li><a href="#">Contate-nos</a></li>
                        </ul>
                    </div>

                </div>
            </div>
            <!-- Botões de Login e Register -->
            <div class="sign-buttons d-flex" id="auth-buttons">
                <a href="/html/signup.html" class="text-decoration-none">
                    <button class="sign-in-btn btn text-white me-3 rounded-pill text-nowrap">Inscrever-se</button>
                </a>
                <a href="/html/signin.html" class="text-decoration-none">
                    <button class="btn btn-light rounded-pill px-5">Entrar</button>
                </a>
            </div>
        </div>
    </div>

    <div class="main-content d-flex justify-content-center">
        <div class="main-container row">
            <h2 class="text-white text-center mb-4">Contate-nos</h2>

            <!-- Formulário -->
            <form id="contactForm">
                <div class="input-container mb-3">
                    <input type="text" class="form-input text-white bg-dark text-white" placeholder="Nome" required>
                </div>
                <div class="input-container mb-3">
                    <input type="email" class="form-input text-white bg-dark text-white" placeholder="E-mail" required>
                </div>
                <div class="input-container mb-3">
                    <input type="tel" class="form-input text-white bg-dark text-white" id="phone"
                        placeholder="Telefone">
                </div>
                <div class="message-containet mb-3">
                    <textarea class="form-input text-white bg-dark text-white" placeholder="Mensagem" rows="12"
                        required></textarea>
                </div>
                <button type="submit" class="btn btn-light">Enviar</button>
            </form>

            <!-- Listagem de contatos (API fake) -->
            <div class="contacts-container">
                <h4 class="text-white mb-3">Últimas Mensagens</h4>
                <div id="contactsList"></div>
            </div>
        </div>
    </div>

    <!-- Toast Component (Standalone) -->
    <div id="toast" class="toast hidden fixed-bottom mb-5 ms-auto me-5 bg-success">
        <div class="toast-body text-white">Mensagem enviada!</div>
    </div>

    <script>
        const BASE_API = 'http://localhost:3000/contacts';
        const API_URL = `${BASE_API}?_sort=createdAt&_order=desc&_limit=3`;

        function renderContacts(contacts) {
            const html = contacts.map(contact => `
            <div class="message-card">
                <div class="d-flex justify-content-between mb-2">
                    <h6 class="text-white mb-0">${contact.name}</h6>
                    <small class="text-muted">${new Date(contact.createdAt).toLocaleDateString()}</small>
                </div>
                <p class="text-white-50 mb-0">${contact.message}</p>
            </div>
        `).join('');

            $('#contactsList').html(html || '<p class="text-white-50">Nenhuma mensagem recente</p>');
        }

        function showApiError(message) {
            $('#contactsList').html(`
            <div class="alert alert-danger">
                <i class="bi bi-exclamation-triangle"></i>
                ${message}
            </div>
        `);
        }

        function loadContacts() {
            fetch(API_URL)
                .then(res => {
                    if (!res.ok) throw new Error('API não respondeu');
                    return res.json();
                })
                .then(renderContacts)
                .catch(error => {
                    showApiError('Servidor de mensagens offline. Tente novamente mais tarde.');
                    console.error('Erro API:', error);
                });
        }

        $(document).ready(() => {
            $('#phone').mask('(00) 00000-0000');
            loadContacts();
        });

        $('#contactForm').submit(async (e) => {
            e.preventDefault();

            const formData = {
                name: $('#contactForm input[type="text"]').val(),
                email: $('#contactForm input[type="email"]').val(),
                phone: $('#phone').val(),
                message: $('#contactForm textarea').val(),
                createdAt: new Date().toISOString()
            };

            try {
                const response = await fetch(BASE_API, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(formData)
                });

                if (!response.ok) throw new Error('Falha no envio');

                loadContacts();
                $('#contactForm')[0].reset();
                $('#toast').removeClass('hidden').delay(3000).fadeOut();
            } catch (error) {
                console.error('Erro:', error);
                $('#toast').removeClass('bg-success').addClass('bg-danger')
                    .find('.toast-body').text('Erro ao enviar! Verifique o servidor.');
                $('#toast').removeClass('hidden').delay(3000).fadeOut();
            }
        });
    </script>
</body>

</html>